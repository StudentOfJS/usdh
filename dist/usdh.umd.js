(function(r,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.usdh={},r.react))})(this,function(r,e){"use strict";const R=Promise.resolve().then(()=>P),E=Promise.resolve().then(()=>A);function O(a,l){const[h,i]=e.useState(null),[w,u]=e.useState(null),[d,c]=e.useState(!0);return e.useEffect(()=>{let t;return typeof Worker<"u"&&(t=new Worker("/worker.js?worker&inline")),t?(t.postMessage({url:a,init:l}),t.onmessage=n=>{const{data:b,error:g}=n.data;g?u(g):i(b),c(!1)}):fetch(a,l).then(n=>n.json()).then(n=>{i(n),c(!1)}).catch(n=>{u(n),c(!1)}),()=>{t&&t.terminate()}},[a]),{data:h,error:w,loading:d}}const P=Object.freeze(Object.defineProperty({__proto__:null,default:O},Symbol.toStringTag,{value:"Module"}));function $({url:a,init:l,optimisticData:h,useStaleCache:i,retry:w=0,onError:u,invalidateCache:d=!1,cacheKey:c=a,expiration:t,errorHandlers:n}){const[b,g]=e.useState(h||null),[M,p]=e.useState(!0),[q,k]=e.useState(null),[S,v]=e.useState(w),T=e.useRef(),m=e.useRef(new AbortController),C=e.useCallback(async()=>{h&&p(!1);try{const s=await caches.open("usdh-cache"),j=await s.match(c);if(j&&!d){let o=0;if(t)o=Date.now()+t*1e3;else{const y=j.headers.get("Cache-Control");if(console.log("trying"),y){console.log("trying cache");const _=y.split("max-age=")[1];_&&(o=Date.now()+Number(_)*1e3)}}if((o>Date.now()||i)&&(g(await j.json()),p(!1),!i))return}const f=await fetch(a,{...l,signal:m.current.signal});if(f.ok){const o=f.headers.get("Cache-Control");if(o||t){const y=new Request(c);s.put(y,f.clone(),{expiration:t||o})}g(await f.json())}else{const o=new Error(`Error ${f.status}: ${f.statusText}`);u&&u(o),n&&n[f.status]&&n[f.status](o),k(o),D()}}catch(s){u&&s instanceof Error&&(u(s),D()),s instanceof Error&&k(s)}finally{p(!1)}},[a,d,c,t,l,n,u]);function D(){if(S>0){m.current=new AbortController;const s=2**(w-S+1)*1e3;v(S-1),T.current=setTimeout(()=>C(),s)}}return e.useEffect(()=>(m.current=new AbortController,()=>{m.current.abort()}),[]),e.useEffect(()=>(C(),()=>{clearTimeout(T.current)}),[a,d,c,t,l]),{data:b,loading:M,error:q}}const A=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"}));r.useBackgroundFetch=R,r.useData=E,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
